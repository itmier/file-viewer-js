(function(n,i){typeof exports=="object"&&typeof module<"u"?module.exports=i(require("element-plus")):typeof define=="function"&&define.amd?define(["element-plus"],i):(n=typeof globalThis<"u"?globalThis:n||self,n.FileView=i(n.ElementPlus))})(this,function(n){"use strict";var h=Object.defineProperty;var c=(n,i,o)=>i in n?h(n,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[i]=o;var l=(n,i,o)=>(c(n,typeof i!="symbol"?i+"":i,o),o);class i{constructor({files:e,showUrl:t}){l(this,"fileViewDescElement",null);l(this,"toolPanelParams",{scale:1,rotate:0});l(this,"needTools",!0);l(this,"loadingInstance",null);l(this,"maskElement",null);l(this,"showElement",null);l(this,"maskEnableClick",!1);l(this,"currentIndex",0);l(this,"files");this.files=e,this.currentIndex=this.files.findIndex(s=>s.url===t),this.initMask(),this.addCLoseIcon(),this.initArrow(),this.initTools(),this.showFile(this.files[this.currentIndex]),this.initFileName()}initMask(){this.maskElement=document.createElement("div"),this.maskElement.classList.add("file-view-mask");const{innerWidth:e,innerHeight:t}=window;this.maskElement.style.width=e+"px",this.maskElement.style.height=t+"px",document.body.appendChild(this.maskElement),this.maskElement.addEventListener("click",s=>{this.maskEnableClick||s.stopPropagation()})}initTools(){const e=document.createElement("div");e.classList.add("file-view-tools");const t=document.createElement("div");t.className="enlarge-btn tool-btn",t.addEventListener("click",()=>{this.handleTool("enlarge")});const s=document.createElement("div");s.className="narrow-btn tool-btn",s.addEventListener("click",()=>{this.handleTool("narrow")});const a=document.createElement("div");a.className="reset-btn tool-btn",a.addEventListener("click",()=>{this.handleTool("reset")});const r=document.createElement("div");r.className="left-rotate-btn tool-btn",r.addEventListener("click",()=>{this.handleTool("left-rotate")});const d=document.createElement("div");d.className="right-rotate-btn tool-btn",d.addEventListener("click",()=>{this.handleTool("right-rotate")}),this.maskElement&&(e.appendChild(t),e.appendChild(s),e.appendChild(a),e.appendChild(r),e.appendChild(d),this.maskElement.appendChild(e))}addCLoseIcon(){const e=document.createElement("div");e.classList.add("file-view-close"),e.addEventListener("click",()=>{this.close()}),this.maskElement&&this.maskElement.appendChild(e)}initArrow(){if(this.maskElement){const e=document.createElement("div");e.classList.add("left-arrow"),e.id="left-arrow",e.addEventListener("click",()=>{if(this.currentIndex>0){const s=this.currentIndex-1;this.jumpSwitch(s)}}),this.maskElement.appendChild(e);const t=document.createElement("div");t.classList.add("right-arrow"),t.id="right-arrow",t.addEventListener("click",()=>{if(this.currentIndex<this.files.length-1){const s=this.currentIndex+1;this.jumpSwitch(s)}}),this.maskElement.appendChild(t),this.arrowIsActive()}}loadImage(e){this.maskElement&&!this.showElement&&(this.showElement=document.createElement("div"),this.showElement.setAttribute("id","show-element"),this.showElement.classList.add("show-element"),this.maskElement.appendChild(this.showElement)),this.clearShowContent();const t=new Image;t.src=e,t.id="img-box",t.addEventListener("load",()=>{this.showElement&&(this.showElement.appendChild(t),this.showElement.addEventListener("wheel",s=>{s.deltaY<0?this.handleTool("enlarge"):this.handleTool("narrow")}))}),t.addEventListener("error",s=>{console.log("图片加载失败"),console.log(s),this.handleImgLoadError()})}handleImgLoadError(){if(!this.showElement)return;const e=document.createElement("div");e.classList.add("error-tips-text"),e.innerHTML="文件类型不支持预览, 请自行下载后预览";const t=document.createElement("div");t.classList.add("to-download"),t.innerHTML="点击下载",t.addEventListener("click",()=>{const{url:a}=this.files[this.currentIndex],r=document.createElement("a");r.href=a,r.click()});const s=document.createElement("div");s.classList.add("error-tips"),s.appendChild(e),s.appendChild(t),this.showElement.appendChild(s)}loadPDF(e){this.maskElement&&!this.showElement&&(this.showElement=document.createElement("div"),this.showElement.setAttribute("id","show-element"),this.showElement.classList.add("show-element"),this.maskElement.appendChild(this.showElement)),this.clearShowContent();const t=document.createElement("div");t.classList.add("pdf-box"),t.innerHTML="点击预览PDF文件",t.addEventListener("click",()=>{this.previewPDF(e)}),this.showElement&&this.showElement.appendChild(t)}clearShowContent(){this.showElement&&(this.showElement.innerHTML="")}getFileType(e){let t="img";const s=e.split("."),a=s[s.length-1].toLowerCase();return a==="pdf"&&(t=a),t}showFile(e){!e||!e.url||this.getFileType(e.originName)==="pdf"||this.loadImage(e.url)}open(){}close(){this.maskElement&&(this.maskElement.parentElement&&this.maskElement.parentElement.removeChild(this.maskElement),this.maskElement=null)}jumpSwitch(e){var s;this.initToolPanelParams(),((s=this.files[e])==null?void 0:s.url)&&(this.currentIndex=e,this.showFile(this.files[this.currentIndex]),this.setFilePageName(),this.arrowIsActive())}showLoading(){this.loadingInstance=n.ElLoading.service({fullscreen:!0,target:this.showElement})}closeLoading(){this.loadingInstance.close()}async previewPDF(e){}async getBlobFile(e){}initToolPanelParams(){this.toolPanelParams={scale:1,rotate:0}}handleImg(){const e=document.getElementById("img-box");e&&(e.style.transform=`scale(${this.toolPanelParams.scale}) rotate(${this.toolPanelParams.rotate}deg)`,e.style.transition="all 0.12s")}handleTool(e){let t=this.toolPanelParams.scale,s=this.toolPanelParams.rotate;switch(e){case"enlarge":t+=.1,t>=5&&(t=5),this.toolPanelParams.scale=t,this.handleImg();break;case"narrow":t-=.1,t<=.1&&(t=.1),this.toolPanelParams.scale=t,this.handleImg();break;case"reset":this.initToolPanelParams(),this.handleImg();break;case"left-rotate":s=s-90,this.toolPanelParams.rotate=s,this.handleImg();break;case"right-rotate":s=s+90,this.toolPanelParams.rotate=s,this.handleImg();break}}arrowIsActive(){const e=document.getElementById("left-arrow"),t=document.getElementById("right-arrow");if(this.currentIndex===this.files.length-1){e&&e.classList.remove("deactive"),t&&t.classList.add("deactive");return}else if(this.currentIndex===0){t&&t.classList.remove("deactive"),e&&e.classList.add("deactive");return}t&&t.classList.remove("deactive"),e&&e.classList.remove("deactive")}initFileName(){this.maskElement&&(this.fileViewDescElement=document.createElement("div"),this.fileViewDescElement.classList.add("file-view-desc"),this.fileViewDescElement.id="file-view-desc",this.maskElement.appendChild(this.fileViewDescElement),this.setFilePageName())}setFilePageName(){if(this.fileViewDescElement){const e=`${this.currentIndex+1}/${this.files.length}`;this.fileViewDescElement.innerHTML=e}}}const o="";return i});
